(()=>{"use strict";var e,s,t={997(e){e.exports=window.wp.blocks}},a={};function r(e){var s=a[e];if(void 0!==s)return s.exports;var i=a[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return r.d(s,{a:s}),s},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(t,a){if(1&a&&(t=this(t)),8&a)return t;if("object"==typeof t&&t){if(4&a&&t.__esModule)return t;if(16&a&&"function"==typeof t.then)return t}var i=Object.create(null);r.r(i);var n={};e=e||[null,s({}),s([]),s(s)];for(var o=2&a&&t;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=s(o))Object.getOwnPropertyNames(o).forEach(e=>n[e]=()=>t[e]);return n.default=()=>t,r.d(i,n),i},r.d=(e,s)=>{for(var t in s)r.o(s,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},r.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const i=window.wp.element,n=window.wp.domReady;var o=r.n(n);const l=window.wp.i18n,c=window.wp.data,d=window.wp.components,p=window.wp.primitives,h=window.ReactJSXRuntime;var u=(0,h.jsx)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(p.Path,{d:"M18.3 11.7c-.6-.6-1.4-.9-2.3-.9H6.7l2.9-3.3-1.1-1-4.5 5L8.5 16l1-1-2.7-2.7H16c.5 0 .9.2 1.3.5 1 1 1 3.4 1 4.5v.3h1.5v-.2c0-1.5 0-4.3-1.5-5.7z"})}),m=(0,h.jsx)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(p.Path,{d:"M15.6 6.5l-1.1 1 2.9 3.3H8c-.9 0-1.7.3-2.3.9-1.4 1.5-1.4 4.2-1.4 5.6v.2h1.5v-.3c0-1.1 0-3.5 1-4.5.3-.3.7-.5 1.3-.5h9.2L14.5 15l1.1 1.1 4.6-4.6-4.6-5z"})}),_=(0,h.jsx)(p.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(p.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})});const g=window.wp.blockEditor;function f(e){return"string"!=typeof e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function x(e){return"string"!=typeof e?"":e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function b(e){return function(e,s){let t="";if(/youtube\.com|youtu\.be|vimeo\.com|dailymotion\.com|twitter\.com|x\.com/i.test(s)){const e=x(s),r=/youtube\.com|youtu\.be/i.test(a=s)?"youtube":/vimeo\.com/i.test(a)?"vimeo":/dailymotion\.com/i.test(a)?"dailymotion":/twitter\.com|x\.com/i.test(a)?"twitter":"embed";t+=`\x3c!-- wp:embed {"url":"${e}","type":"video","providerNameSlug":"${r}"} --\x3e\n<figure class="wp-block-embed is-type-video is-provider-${r}"><div class="wp-block-embed__wrapper">\n${f(s)}\n</div></figure>\n\x3c!-- /wp:embed --\x3e\n\n`}var a;e.description&&(t+=`\x3c!-- wp:quote --\x3e\n<blockquote class="wp-block-quote">\x3c!-- wp:paragraph --\x3e\n<p>${f(e.description)}</p>\n\x3c!-- /wp:paragraph --\x3e</blockquote>\n\x3c!-- /wp:quote --\x3e\n\n`);const r=e.title||e.siteName||s;return t+=`\x3c!-- wp:paragraph --\x3e\n<p>Source: <em><a href="${x(s)}">${f(r)}</a></em></p>\n\x3c!-- /wp:paragraph --\x3e`,t}(e,e.canonical||e.url||"")}function w(){return"undefined"!=typeof navigator&&/Mac|iPod|iPhone|iPad/.test(navigator.platform)}function v({siteName:e,siteUrl:s,sourceUrl:t,isLegacyBookmarklet:a,hasBookmarkletContent:r=!1,hasBookmarkletMedia:n=!1,proxyEnabled:o,restUrl:p,restNonce:f,onScrapeComplete:x,onSave:v,isSaving:j=!1,publishLabel:y=(0,l.__)("Publish","press-this")}){const[S,N]=(0,i.useState)(t||""),[k,C]=(0,i.useState)(!1),[U,P]=(0,i.useState)(""),[B,T]=(0,i.useState)(a),F=(0,i.useRef)(!1),{hasUndo:R,hasRedo:E}=(0,c.useSelect)(e=>{const s=e(g.store);return{hasUndo:"function"==typeof s.hasUndo&&s.hasUndo(),hasRedo:"function"==typeof s.hasRedo&&s.hasRedo()}},[]),{undo:M,redo:O}=(0,c.useDispatch)(g.store),I=w()?"⌘Z":"Ctrl+Z",L=w()?"⇧⌘Z":"Ctrl+Shift+Z",D=(0,i.useCallback)(async(e=!1)=>{if(S){C(!0),P("");try{const s=await fetch(`${p}scrape`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":f},body:JSON.stringify({url:S})}),t=await s.json();if(!s.ok)throw new Error(t.message||(0,l.__)("Failed to fetch URL","press-this"));if(x)if(e)x({title:"",content:"",images:t.images||[],embeds:t.embeds||[],sourceUrl:S,mediaOnly:!0});else{const e=b({title:t.title||"",description:t.description||"",siteName:"",canonical:t.canonical||S,url:t.final_url||S});x({title:t.title||"",content:e,images:t.images||[],embeds:t.embeds||[],sourceUrl:S})}}catch(e){P(e.message)}finally{C(!1)}}},[S,p,f,x]),$=(0,i.useCallback)(()=>{if(!S)return;C(!0);const e=new URL(window.location.href);e.searchParams.set("u",S),window.location.href=e.toString()},[S]),A=(0,i.useCallback)(()=>{o?D():$()},[o,D,$]);(0,i.useEffect)(()=>{t&&o&&!F.current&&(r?n||(F.current=!0,D(!0)):(F.current=!0,D(!1)))},[t,o,r,n,D]);const z=(0,i.useCallback)(e=>{e.preventDefault(),A()},[A]),q=(0,i.useCallback)(()=>{v&&v("draft")},[v]),H=(0,i.useCallback)(()=>{v&&v("publish")},[v]),J=(0,i.useCallback)(()=>{v&&v("draft",{forceRedirect:!0})},[v]),W=o,X="function"==typeof v;return(0,h.jsxs)("header",{className:"press-this-header",children:[(0,h.jsxs)("div",{className:"press-this-header__bar",children:[(0,h.jsx)("div",{className:"press-this-header__site",children:(0,h.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"press-this-header__site-link",children:[(0,h.jsx)("span",{className:"dashicons dashicons-wordpress press-this-header__wp-icon","aria-hidden":"true"}),(0,h.jsx)("span",{className:"press-this-header__site-name",children:e})]})}),(0,h.jsxs)("div",{className:"press-this-header__toolbar",children:[(0,h.jsx)(d.Tooltip,{text:`${(0,l.__)("Undo","press-this")} (${I})`,children:(0,h.jsx)(d.Button,{className:"press-this-header__toolbar-button",icon:u,onClick:M,disabled:!R,"aria-label":(0,l.__)("Undo","press-this")})}),(0,h.jsx)(d.Tooltip,{text:`${(0,l.__)("Redo","press-this")} (${L})`,children:(0,h.jsx)(d.Button,{className:"press-this-header__toolbar-button",icon:m,onClick:O,disabled:!E,"aria-label":(0,l.__)("Redo","press-this")})})]}),W&&(0,h.jsxs)("form",{className:"press-this-header__scanner",onSubmit:z,children:[(0,h.jsx)(d.TextControl,{className:"press-this-header__url-input",value:S,onChange:N,placeholder:(0,l.__)("Enter a URL to scan","press-this"),type:"url",hideLabelFromVision:!0,label:(0,l.__)("URL to scan","press-this"),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,h.jsx)(d.Button,{variant:"secondary",onClick:A,disabled:!S||k,isBusy:k,children:(0,l.__)("Scan","press-this")})]}),X&&(0,h.jsxs)("div",{className:"press-this-header__actions",children:[(0,h.jsx)(d.Button,{variant:"tertiary",onClick:q,disabled:j,className:"press-this-header__save-draft",children:(0,l.__)("Save Draft","press-this")}),(0,h.jsx)(d.Button,{variant:"primary",onClick:H,disabled:j,isBusy:j,className:"press-this-header__publish",children:y}),(0,h.jsx)(d.DropdownMenu,{icon:_,label:(0,l.__)("More actions","press-this"),className:"press-this-header__more-menu",children:({onClose:e})=>(0,h.jsx)(d.MenuGroup,{children:(0,h.jsx)(d.MenuItem,{onClick:()=>{J(),e()},children:(0,l.__)("Continue in Standard Editor","press-this")})})})]})]}),U&&(0,h.jsx)(d.Notice,{className:"press-this-header__notice",status:"error",onRemove:()=>P(""),children:U}),B&&(0,h.jsx)(d.Notice,{className:"press-this-header__notice",status:"warning",onRemove:()=>T(!1),children:(0,l.__)("Your bookmarklet is out of date. Please update it for the best experience.","press-this")})]})}var j=r(997);const y=window.wp.blockLibrary;function S(e){if(!e||"string"!=typeof e)return"";const s=e.trim();return/^(?:https?:)?\/\//i.test(s)?s.replace(/["\\<>]/g,""):""}function N(e){try{return new URL(e).hostname.replace(/^www\./,"")}catch{return e}}function k({images:e=[],embeds:s=[],onInsertBlock:t,sourceUrl:a=""}){const[r,n]=(0,i.useState)([]),[o,c]=(0,i.useState)(!0),[p,u]=(0,i.useState)(!0),m=(0,i.useMemo)(()=>{const s=new Set;return e.map(S).filter(e=>!(!e||s.has(e)||(s.add(e),0)))},[e]),_=(0,i.useMemo)(()=>{const e=new Set;return s.map(S).filter(s=>!(!s||e.has(s)||(e.add(s),0)))},[s]);(0,i.useEffect)(()=>{m.length>0?(c(!0),function(e,s){const t=[];let a=e.length;0!==a?e.forEach(e=>{const r=new Image;r.onload=()=>{r.width>=256&&r.height>=128&&t.push(e),a--,0===a&&s(t)},r.onerror=()=>{a--,0===a&&s(t)},r.src=e}):s([])}(m,e=>{n(e),c(!1)})):(n([]),c(!1))},[m]);const g=(0,i.useCallback)(e=>{const s=(0,j.createBlock)("core/image",{url:e,alt:""});t(s)},[t]),f=(0,i.useCallback)(e=>{const s=(0,j.createBlock)("core/embed",{url:e});t(s)},[t]),x=r.length>0||_.length>0;return x||o?(0,h.jsxs)("div",{className:"press-this-editor__panel press-this-scraped-media",children:[(0,h.jsxs)("button",{type:"button",className:"press-this-scraped-media__header",onClick:()=>u(!p),"aria-expanded":p,children:[(0,h.jsx)("h3",{children:(0,l.__)("Scraped Media","press-this")}),(0,h.jsx)("span",{className:`dashicons dashicons-arrow-${p?"up":"down"}-alt2`,"aria-hidden":"true"})]}),p&&(0,h.jsxs)("div",{className:"press-this-scraped-media__content",children:[a&&(0,h.jsxs)("p",{className:"press-this-scraped-media__source",children:[(0,l.__)("From:","press-this")," ",(0,h.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",children:N(a)})]}),o&&(0,h.jsxs)("div",{className:"press-this-scraped-media__loading",children:[(0,h.jsx)(d.Spinner,{}),(0,h.jsx)("span",{children:(0,l.__)("Loading images…","press-this")})]}),_.length>0&&(0,h.jsxs)("div",{className:"press-this-scraped-media__section",children:[(0,h.jsx)("h4",{children:(0,l.__)("Embeds","press-this")}),(0,h.jsx)("ul",{className:"press-this-scraped-media__embeds",children:_.map((e,s)=>(0,h.jsx)("li",{children:(0,h.jsxs)(d.Button,{variant:"secondary",onClick:()=>f(e),className:"press-this-scraped-media__embed-button",children:[(0,h.jsx)("span",{className:"dashicons dashicons-embed-video","aria-hidden":"true"}),(0,h.jsx)("span",{className:"press-this-scraped-media__embed-domain",children:N(e)})]})},s))})]}),r.length>0&&(0,h.jsxs)("div",{className:"press-this-scraped-media__section",children:[(0,h.jsx)("h4",{children:(0,l.__)("Images","press-this")}),(0,h.jsx)("div",{className:"press-this-scraped-media__images",children:r.map((e,s)=>(0,h.jsx)("button",{type:"button",className:"press-this-scraped-media__image-button",onClick:()=>g(e),title:(0,l.__)("Click to insert","press-this"),children:(0,h.jsx)("img",{src:e,alt:(0,l.__)("Scraped image","press-this"),loading:"lazy"})},s))})]}),!o&&!x&&(0,h.jsx)("p",{className:"press-this-scraped-media__empty",children:(0,l.__)("No media found on this page.","press-this")})]})]}):null}function C({onSelect:e,onRemove:s,scrapedImages:t=[],restConfig:a={},postId:r=0}){const[n,o]=(0,i.useState)(null),[c,p]=(0,i.useState)(!1),[u,m]=(0,i.useState)(null),[_,g]=(0,i.useState)([]),[f,x]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t.length>0?(x(!0),function(e,s){const t=[];let a=e.length;0!==a?e.forEach(e=>{const r=new Image;r.onload=()=>{r.width>=100&&r.height>=100&&t.push(e),a--,0===a&&s(t)},r.onerror=()=>{a--,0===a&&s(t)},r.src=e}):s([])}(t.slice(0,12),e=>{g(e),x(!1)})):(g([]),x(!1))},[t]);const b=(0,i.useCallback)(s=>{s&&s.id&&(o({id:s.id,url:s.url||s.sizes?.medium?.url||s.sizes?.full?.url,alt:s.alt||""}),e(s.id))},[e]),w=(0,i.useCallback)(()=>{o(null),s()},[s]),v=(0,i.useCallback)(()=>{!function(e){const s=window.wp.media({title:(0,l.__)("Select Featured Image","press-this"),button:{text:(0,l.__)("Set featured image","press-this")},multiple:!1,library:{type:"image"}});s.on("select",()=>{const t=s.state().get("selection").first().toJSON();e(t)}),s.open()}(b)},[b]),j=(0,i.useCallback)(async s=>{if(a.restUrl&&a.restNonce){p(!0),m(null);try{const t=await async function(e,s,t=0){const a=await fetch(`${s.restUrl}sideload`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":s.restNonce},body:JSON.stringify({url:e,post_id:t})}),r=await a.json();if(!a.ok||!r.success)throw new Error(r.message||"Failed to sideload image");return r}(s,a,r);o({id:t.id,url:t.url,alt:""}),e(t.id)}catch(e){m(e.message||(0,l.__)("Failed to set featured image.","press-this"))}finally{p(!1)}}else m((0,l.__)("REST API configuration missing.","press-this"))},[a,r,e]);return(0,h.jsx)(d.PanelBody,{title:(0,l.__)("Featured Image","press-this"),initialOpen:!1,children:(0,h.jsxs)("div",{className:"press-this-featured-image",children:[n&&n.url?(0,h.jsxs)("div",{className:"press-this-featured-image__preview",children:[(0,h.jsx)("img",{src:n.url,alt:n.alt||(0,l.__)("Featured image","press-this"),className:"press-this-featured-image__image"}),(0,h.jsxs)("div",{className:"press-this-featured-image__actions",children:[(0,h.jsx)(d.Button,{variant:"secondary",onClick:v,className:"press-this-featured-image__replace",children:(0,l.__)("Replace","press-this")}),(0,h.jsx)(d.Button,{variant:"link",isDestructive:!0,onClick:w,className:"press-this-featured-image__remove",children:(0,l.__)("Remove","press-this")})]})]}):(0,h.jsx)(d.Button,{variant:"secondary",onClick:v,className:"press-this-featured-image__set",children:(0,l.__)("Set featured image","press-this")}),(_.length>0||f)&&!n&&(0,h.jsxs)("div",{className:"press-this-featured-image__scraped",children:[(0,h.jsx)("h4",{className:"press-this-featured-image__scraped-title",children:(0,l.__)("From Source","press-this")}),(c||f)&&(0,h.jsxs)("div",{className:"press-this-featured-image__loading",children:[(0,h.jsx)(d.Spinner,{}),(0,h.jsx)("span",{children:c?(0,l.__)("Uploading…","press-this"):(0,l.__)("Loading…","press-this")})]}),u&&(0,h.jsx)("p",{className:"press-this-featured-image__error",children:u}),!c&&!f&&_.length>0&&(0,h.jsx)("div",{className:"press-this-featured-image__scraped-grid",children:_.slice(0,6).map((e,s)=>(0,h.jsx)("button",{type:"button",className:"press-this-featured-image__scraped-item",onClick:()=>j(e),title:(0,l.__)("Set as featured image","press-this"),children:(0,h.jsx)("img",{src:e,alt:"",loading:"lazy"})},s))})]})]})})}function U(){return(0,c.useSelect)(e=>{const{getSelectedBlockClientId:s}=e(g.store);return!!s()},[])?(0,h.jsx)(d.PanelBody,{title:(0,l.__)("Block Settings","press-this"),initialOpen:!0,children:(0,h.jsx)(g.BlockInspector,{})}):null}let P=!1;function B(e,s=!1){const t=function(e,s={}){const t=s.fallback||"/wp-admin/";if(!e)return t;try{const s=new URL(e,window.location.origin),a=window.location.host;return s.host===a?e:s.host&&s.origin!==window.location.origin?(window.pressThisEditorSettings?.scriptDebug&&console.warn("Press This: Blocked external redirect to",s.host,"- using fallback"),t):e}catch(e){return window.pressThisEditorSettings?.scriptDebug&&console.warn("Press This: Invalid redirect URL - using fallback"),t}}(e);if(s&&window.opener){try{if(window.opener.location.origin===window.location.origin)return window.opener.location.href=t,void window.close()}catch(e){console.warn("Press This: Cannot redirect cross-origin parent window")}window.location.href=t}else window.location.href=t}function T({post:e,settings:s,images:t=[],embeds:a=[],categories:n=[],postFormats:o=[],capabilities:c={},restConfig:p={},sourceUrl:u="",pendingScrape:m=null,onScrapeProcessed:_=()=>{},onSaveReady:f=()=>{},categoryNonce:x="",ajaxUrl:b=""}){(0,i.useEffect)(()=>{P||((0,y.registerCoreBlocks)(),P=!0)},[]);const[w,v]=(0,i.useState)([]),[S,N]=(0,i.useState)(e.title||""),T=s.postFormatOverride||s.suggestedPostFormat||s.postFormatDefault||"",[F,R]=(0,i.useState)(T),[E,M]=(0,i.useState)([]),[O,I]=(0,i.useState)([]),[L,D]=(0,i.useState)(0),[$,A]=(0,i.useState)(!1),[z,q]=(0,i.useState)(!1),[H,J]=(0,i.useState)(null),[W,X]=(0,i.useState)(n),[V,G]=(0,i.useState)(!1),[Z,K]=(0,i.useState)(""),[Y,Q]=(0,i.useState)(0),[ee,se]=(0,i.useState)(!1),[te,ae]=(0,i.useState)(""),[re,ie]=(0,i.useState)([]),[ne,oe]=(0,i.useState)(!1),le=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(e.content){const s=(0,j.parse)(e.content);v(s)}q(!0)},[e.content]),(0,i.useEffect)(()=>{if(m){if(!S.trim()&&m.title&&N(m.title),m.content){const e=(0,j.parse)(m.content);v(s=>[...s,...e])}_()}},[m,_]);const ce=(0,i.useCallback)(e=>{v(e)},[]),de=(0,i.useCallback)(e=>{v(s=>[...s,e])},[]),pe=(0,i.useCallback)(async(s="draft",t={})=>{A(!0);try{const{serialize:a}=await Promise.resolve().then(r.t.bind(r,997,23)),i=a(w),n=await fetch(`${p.restUrl}save`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":p.restNonce},body:JSON.stringify({post_id:e.id,title:S,content:i,status:s,format:F,categories:E,tags:O,featured_image:L,force_redirect:t.forceRedirect||!1})}),o=await n.json();n.ok&&o.success?o.redirect?o.force?B(o.redirect,!1):p.redirInParent&&window.opener?B(o.redirect,!0):B(o.redirect,!1):J({status:"success",message:(0,l.__)("Draft saved.","press-this")}):J({status:"error",message:o.message||(0,l.__)("Error saving post.","press-this")})}catch(e){J({status:"error",message:(0,l.__)("Error saving post.","press-this")})}finally{A(!1)}},[w,S,F,E,O,L,e.id,p]),he=c.canPublish?(0,l.__)("Publish","press-this"):(0,l.__)("Submit for Review","press-this");(0,i.useEffect)(()=>{f({handleSave:pe,isSaving:$,publishLabel:he})},[pe,$,he,f]);const ue=(0,i.useCallback)(e=>{N(e.target.value)},[]),me=(0,i.useCallback)(e=>{if("Enter"===e.key){e.preventDefault();const s=document.querySelector(".block-editor-block-list__layout");if(s){const e=s.querySelector("[data-block]");e&&e.focus()}}},[]),_e=(0,i.useCallback)(async()=>{if(Z.trim()&&x&&b){se(!0),ae("");try{const e=new URLSearchParams;e.append("action","press-this-plugin-add-category"),e.append("new_cat_nonce",x),e.append("name",Z.trim()),e.append("parent",Y.toString());const s=await fetch(b,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}),t=await s.json();if(t.success&&t.data&&t.data.length>0){const e=t.data.map(e=>({id:e.term_id,name:e.name,parent:e.parent}));X(s=>[...s,...e]);const s=e.map(e=>e.id);M(e=>[...e,...s]),K(""),Q(0),G(!1)}else ae(t.data?.errorMessage||(0,l.__)("Failed to create category.","press-this"))}catch(e){ae((0,l.__)("Failed to create category.","press-this"))}finally{se(!1)}}},[Z,Y,x,b]),ge=(0,i.useMemo)(()=>{const e=[{value:0,label:(0,l.__)("— Parent Category —","press-this")}],s=(t,a=0,r=0)=>{t.filter(e=>(e.parent||0)===a).forEach(a=>{const i=" ".repeat(3*r);e.push({value:a.id,label:i+a.name}),s(t,a.id,r+1)})};return s(W),e},[W]),fe=(0,i.useCallback)(e=>{le.current&&clearTimeout(le.current),!e||e.length<2?ie([]):le.current=setTimeout(async()=>{oe(!0);try{const s=function(e){if(e.includes("rest_route=")){const s=e.match(/^(.*[?&]rest_route=)/);if(s)return s[1]+"/"}return e.replace(/press-this\/v1\/$/,"")}(p.restUrl),t=s.includes("rest_route=")?`${s}wp/v2/tags&search=${encodeURIComponent(e)}&per_page=10`:`${s}wp/v2/tags?search=${encodeURIComponent(e)}&per_page=10`,a=await fetch(t,{headers:{"X-WP-Nonce":p.restNonce}});if(a.ok){const e=(await a.json()).map(e=>e.name);ie(e)}}catch(e){ie([])}finally{oe(!1)}},300)},[p.restUrl,p.restNonce]),xe=(0,i.useCallback)(e=>{I(e)},[]),be=(0,i.useMemo)(()=>({allowedBlockTypes:s.allowedBlocks,hasFixedToolbar:!0,bodyPlaceholder:(0,l.__)("Start writing or press / to choose a block","press-this"),isRTL:s.isRTL,mediaUpload:c.canUploadFiles?({onFileChange:e})=>{e([])}:void 0}),[s,c.canUploadFiles]);return z?(0,h.jsx)(d.SlotFillProvider,{children:(0,h.jsx)("div",{className:"press-this-editor",children:(0,h.jsxs)(g.BlockEditorProvider,{value:w,onInput:ce,onChange:ce,settings:be,children:[(0,h.jsxs)("div",{className:"press-this-editor__layout",children:[(0,h.jsxs)("div",{className:"press-this-editor__main",children:[(0,h.jsx)("div",{className:"press-this-editor__toolbar",children:(0,h.jsx)(g.BlockToolbar,{hideDragHandle:!0})}),(0,h.jsx)("div",{className:"press-this-editor__title-wrapper",children:(0,h.jsx)("input",{type:"text",className:"press-this-editor__title",value:S,onChange:ue,onKeyDown:me,placeholder:(0,l.__)("Add title","press-this"),"aria-label":(0,l.__)("Post title","press-this")})}),(0,h.jsxs)("div",{className:"press-this-editor__content",children:[(0,h.jsx)(g.BlockEditorKeyboardShortcuts.Register,{}),(0,h.jsx)(g.BlockTools,{children:(0,h.jsx)(g.WritingFlow,{children:(0,h.jsx)(g.ObserveTyping,{children:(0,h.jsx)(g.BlockList,{})})})}),(0,h.jsx)("div",{className:"press-this-editor__inserter",onClickCapture:e=>{if(e.target.closest('[aria-label="Close Block Inserter"]')){e.stopPropagation(),e.preventDefault();const s=document.querySelector(".press-this-editor__inserter-button");s&&s.click()}},children:(0,h.jsx)(g.Inserter,{position:"bottom center",showInserterHelpPanel:!1,renderToggle:({onToggle:e,disabled:s})=>(0,h.jsx)(d.Button,{variant:"primary",className:"press-this-editor__inserter-button",onClick:e,disabled:s,icon:"plus",label:(0,l.__)("Add block","press-this")})})})]})]}),(0,h.jsx)("div",{className:"press-this-editor__sidebar",children:(0,h.jsx)("div",{className:"press-this-editor__sidebar-content",children:(0,h.jsxs)(d.Panel,{children:[(0,h.jsx)(U,{}),(0,h.jsx)(k,{images:t,embeds:a,onInsertBlock:de,sourceUrl:u}),c.canUploadFiles&&(0,h.jsx)(C,{featuredImageId:L,onSelect:D,onRemove:()=>D(0),canUpload:c.canUploadFiles,scrapedImages:t,restConfig:p,postId:e.id}),o.length>0&&(0,h.jsx)(d.PanelBody,{title:(0,l.__)("Format","press-this"),initialOpen:!1,children:(0,h.jsxs)("select",{value:F,onChange:e=>R(e.target.value),className:"press-this-editor__format-select",children:[(0,h.jsx)("option",{value:"",children:(0,l.__)("Standard","press-this")}),o.map(e=>(0,h.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})}),c.canAssignCategories&&W.length>0&&(0,h.jsxs)(d.PanelBody,{title:(0,l.__)("Categories","press-this"),initialOpen:!1,children:[(0,h.jsx)("div",{className:"press-this-editor__categories",children:W.map(e=>(0,h.jsxs)("label",{className:"press-this-editor__category",children:[(0,h.jsx)("input",{type:"checkbox",checked:E.includes(e.id),onChange:s=>{s.target.checked?M([...E,e.id]):M(E.filter(s=>s!==e.id))}}),e.name]},e.id))}),c.canEditCategories&&x&&(0,h.jsxs)("div",{className:"press-this-editor__add-category",children:[(0,h.jsx)(d.Button,{variant:"link",onClick:()=>G(!V),className:"press-this-editor__add-category-toggle",children:V?(0,l.__)("— Close —","press-this"):(0,l.__)("+ Add New Category","press-this")}),V&&(0,h.jsxs)("div",{className:"press-this-editor__add-category-form",children:[(0,h.jsx)(d.TextControl,{value:Z,onChange:K,placeholder:(0,l.__)("New Category Name","press-this"),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,h.jsx)(d.SelectControl,{value:Y,onChange:e=>Q(parseInt(e,10)),options:ge,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),te&&(0,h.jsx)("p",{className:"press-this-editor__add-category-error",children:te}),(0,h.jsx)(d.Button,{variant:"secondary",onClick:_e,disabled:!Z.trim()||ee,isBusy:ee,className:"press-this-editor__add-category-button",children:(0,l.__)("Add New Category","press-this")})]})]})]}),c.canAssignTags&&(0,h.jsxs)(d.PanelBody,{title:(0,l.__)("Tags","press-this"),initialOpen:!1,children:[(0,h.jsx)(d.FormTokenField,{label:(0,l.__)("Add tags","press-this"),value:O,suggestions:re,onChange:xe,onInputChange:fe,placeholder:(0,l.__)("Add tags","press-this"),__experimentalExpandOnFocus:!0,__experimentalShowHowTo:!1,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,h.jsx)("p",{className:"press-this-tags-panel__help",children:(0,l.__)("Separate with commas or the Enter key.","press-this")}),ne&&(0,h.jsx)("div",{className:"press-this-editor__tags-loading",children:(0,h.jsx)(d.Spinner,{})})]})]})})})]}),(0,h.jsx)(d.Popover.Slot,{}),H&&(0,h.jsx)("div",{className:"press-this-editor__notice",children:(0,h.jsx)(d.Snackbar,{status:H.status,onRemove:()=>J(null),children:H.message})})]})})}):(0,h.jsxs)("div",{className:"press-this-loading",children:[(0,h.jsx)(d.Spinner,{}),(0,l.__)("Loading editor…","press-this")]})}function F(){const e=(0,i.useMemo)(()=>window.pressThisData||{},[]),[s,t]=(0,i.useState)(null),[a,r]=(0,i.useState)({handleSave:null,isSaving:!1,publishLabel:(0,l.__)("Publish","press-this")}),n=(0,i.useMemo)(()=>({id:e.postId,title:e.title||"",content:e.content||""}),[e.postId,e.title,e.content]),[o,c]=(0,i.useState)({images:[],embeds:[]}),d=(0,i.useMemo)(()=>({allowedBlocks:e.allowedBlocks||[],isRTL:e.isRTL,suggestedPostFormat:e.suggestedFormat||"",postFormatOverride:e.postFormatOverride||"",postFormatDefault:e.postFormatDefault||""}),[e.allowedBlocks,e.isRTL,e.suggestedFormat,e.postFormatOverride,e.postFormatDefault]),p=(0,i.useMemo)(()=>({canPublish:e.canPublish,canUploadFiles:e.canUploadFiles,canAssignCategories:e.canAssignCategories,canEditCategories:e.canEditCategories,canAssignTags:e.canAssignTags}),[e.canPublish,e.canUploadFiles,e.canAssignCategories,e.canEditCategories,e.canAssignTags]),u=(0,i.useMemo)(()=>({restUrl:e.restUrl,restNonce:e.restNonce,redirInParent:e.redirInParent}),[e.restUrl,e.restNonce,e.redirInParent]),m=(0,i.useMemo)(()=>{const s=[...e.images||[],...o.images];return[...new Set(s)]},[e.images,o.images]),_=(0,i.useMemo)(()=>{const s=[...e.embeds||[],...o.embeds];return[...new Set(s)]},[e.embeds,o.embeds]),g=o.sourceUrl||e.sourceUrl||"",[f,x]=(0,i.useState)(!1),[,w]=(0,i.useState)(null),j=(0,i.useCallback)(async s=>{if(!s||0===s.length)return[];try{const t=await fetch(`${e.restUrl}validate-embeds`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":e.restNonce},body:JSON.stringify({urls:s})});return t.ok&&(await t.json()).embeds||[]}catch{return[]}},[e.restUrl,e.restNonce]);(0,i.useEffect)(()=>{if(e.postMessageMode&&!f)return window.addEventListener("message",s),()=>{window.removeEventListener("message",s)};async function s(s){if(!s.data||"press-this-data"!==s.data.type)return;const a=s.data.data;if(!a)return;x(!0),w(a);const r=a._images||[],i=a.u||e.sourceUrl,n=a._embeds||[],o=await j(n);c(e=>({images:[...e.images,...r],embeds:[...e.embeds,...o],sourceUrl:i}));const l=a._meta||{},d=a.s||l["twitter:description"]||l["og:description"]||l.description||"",p=a.t||l["twitter:title"]||l["og:title"]||l.title||"",h=(a._links||{}).canonical||i,u=b({title:p,description:d,siteName:l["og:site_name"]||"",canonical:h,url:i});(p||u)&&t({title:p,content:u,images:r,embeds:o,sourceUrl:i})}},[e.postMessageMode,e.restUrl,e.restNonce,e.sourceUrl,f,j]);const y=(0,i.useCallback)(e=>{!e.mediaOnly&&e.content&&t(e),c(s=>({images:[...s.images,...e.images||[]],embeds:[...s.embeds,...e.embeds||[]],sourceUrl:e.sourceUrl}))},[]),S=(0,i.useCallback)(()=>{t(null)},[]),N=(0,i.useCallback)(e=>{r(e)},[]);return(0,h.jsxs)("div",{className:"press-this-app",children:[(0,h.jsx)(v,{siteName:e.siteName,siteUrl:e.siteUrl,sourceUrl:e.sourceUrl,isLegacyBookmarklet:e.isLegacyBookmarklet,hasBookmarkletContent:!!e.content,hasBookmarkletMedia:!(!e.images?.length&&!e.embeds?.length),proxyEnabled:e.proxyEnabled,restUrl:e.restUrl,restNonce:e.restNonce,onScrapeComplete:y,onSave:a.handleSave,isSaving:a.isSaving,publishLabel:a.publishLabel}),(0,h.jsx)("div",{className:"press-this-app__body",children:(0,h.jsx)(T,{post:n,settings:d,images:m,embeds:_,categories:e.categories||[],postFormats:e.postFormats||[],capabilities:p,restConfig:u,sourceUrl:g,pendingScrape:s,onScrapeProcessed:S,onSaveReady:N,categoryNonce:e.categoryNonce||"",ajaxUrl:e.ajaxUrl||""})})]})}o()(()=>{const e=document.getElementById("press-this-app");e&&(0,i.createRoot)(e).render((0,h.jsx)(i.StrictMode,{children:(0,h.jsx)(F,{})}))})})();